# MySQL相关知识
## 事务
事务就是一组原子性的SQL操作。具体来讲就是成批的SQL要么都执行，要么都不执行，这保证了数据的完整性。空谈事务的概念是不够的，因为系统要通过严格的ACID测试。一个运行良好的事务处理系统，必须具备这些标准特征：
- **原子性**：整个事务的所有操作要么全部提交成功，要么全部失败回滚。
- **一致性**：在事务开始之前到事务结束以后，数据库的完整性没有破坏。只要事务没有提交，那么事务中所做的修改也不会保存到数据库中
- **隔离性**：通常来讲，一个事务所做的修改在最终提交之前，对其他的事务是不可见的。因为数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致
- **持久性**：一旦事务提交，则所有的修改就会永远保存到数据库中，即便系统故障也不会丢失。
### 并发事务带来哪些问题
- **脏读**：一个事务正在访问数据并对数据进行修改，而修改还没有提交，另一个事务访问了这个数据，并使用了这个数据。
- **丢失数据**：一个事务访问一个数据，另外一个事务也访问了这个数据，那么第一个事务修改了这个数据后，第二个事务也修改了这个数据
- **不可重复读**：一个事务内多次读同一个数据，在这多次读取之间，另一个事务也访问了该数据并且修改了数据，而导致第一个事务读取数据不一样
- **幻读**：它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入或删除了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录
> **不可重复读和幻读区别**：不可重复读的重点是修改比如多次读取一条记录发现其中某些列的值被修改，幻读的重点在于新增或者删除比如多次读取一条记录发现记录增多或减少了
### SQL 标准定义了四个隔离级别：
- **READ-UNCOMMITTED（读取未提交）**：最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读
- **READ-COMMITTED（读取已提交）**：允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生
- **REPEATABLE-READ（可重复读）**：对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生
- **SERIALIZABLE（可串行化）**：最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。
## 优化
优化一般从这几个方面入手：数据库字段设计规范、索引设计规范、数据库 SQL 开发规范（SQL查询规范）、数据库操作行为规范（数据增删改操作规范）、大表优化
### 数据库字段设计规范
#### 1.优先选择符合存储需要的最小的数据类型
原因：列的字段越大，建立索引时所需要的空间也就越大，这样一页中所能存储的索引节点的数量也就越少也越少，在遍历时所需要的 IO 次数也就越多，索引的性能也就越差
- 将字符串转换成数字类型存储
- 对于非负型的数据 (如自增 ID,整型 IP) 来说,要优先使用无符号整型来存储
- VARCHAR(N) 中的 N 代表的是字符数，而不是字节数，使用 UTF8 存储 255 个汉字 Varchar(255)=765 个字节。过大的长度会消耗更多的内存
#### 2.避免使用 TEXT,BLOB 数据类型
如果一定要使用，建议把 BLOB 或是 TEXT 列分离到单独的扩展表中，查询时一定不要使用 select * 而只需要取出必要的列，不需要 TEXT 列的数据时不要对该列进行查询
#### 3. 避免使用 ENUM 类型
修改 ENUM 值需要使用 ALTER 语句；ENUM 类型的 ORDER BY 操作效率低，需要额外操作；禁止使用数值作为 ENUM 的枚举值
#### 4.尽可能把所有列定义为 NOT NULL
原因：索引 NULL 列需要额外的空间来保存，所以要占用更多的空间。进行比较和计算时要对 NULL 值做特别的处理
#### 5. 使用 TIMESTAMP(4 个字节) 或 DATETIME 类型 (8 个字节) 存储时间
TIMESTAMP 存储的时间范围 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07

TIMESTAMP 占用 4 字节和 INT 相同，但比 INT 可读性高

超出 TIMESTAMP 取值范围的使用 DATETIME 类型存储

经常会有人用字符串存储日期型的数据（不正确的做法）
- 缺点 1：无法用日期函数进行计算和比较
- 缺点 2：用字符串存储日期要占用更多的空间
#### 同财务相关的金额类数据必须使用 decimal 类型
Decimal 类型为精准浮点数，在计算时不会丢失精度

占用空间由定义的宽度决定，每 4 个字节可以存储 9 位数字，并且小数点要占用一个字节

可用于存储比 bigint 更大的整型数据